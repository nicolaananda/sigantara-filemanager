FROM node:18-alpine

WORKDIR /app

# Install build dependencies for Sharp
RUN apk add --no-cache \
    python3 \
    make \
    g++ \
    cairo-dev \
    jpeg-dev \
    pango-dev \
    giflib-dev \
    pixman-dev

# Copy package files
COPY workers/queue-processor/package*.json ./
RUN npm install

# Copy source
COPY workers/queue-processor/src ./src
COPY workers/queue-processor/tsconfig.json ./

# Install tsx
RUN npm install -g tsx

CMD ["tsx", "src/local-worker.ts"]
